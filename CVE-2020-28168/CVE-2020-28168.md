# CVE-2020-28168

* NodeJS组件axios<0.21.1 SSRF Bypass

## 简介

* 调用follow-redirects中的request方法时没有对proxy的302情况进行特殊处理，导致ssrf的bypass

## 代码

/lib/adapters/http.js

```js
if (proxy) {
      options.hostname = proxy.host;
      options.host = proxy.host;
      options.headers.host = parsed.hostname + (parsed.port ? ':' + parsed.port : '');
      options.port = proxy.port;
      options.path = protocol + '//' + parsed.hostname + (parsed.port ? ':' + parsed.port : '') + options.path;

      // Basic proxy authorization
      if (proxy.auth) {
          var base64 = Buffer.from(proxy.auth.username + ':' + proxy.auth.password, 'utf8').toString('base64');
          options.headers['Proxy-Authorization'] = 'Basic ' + base64;
      }
    }

var req = transport.request(options, function handleResponse(res) {
    ...
}
```

## POC

https://github.com/ForbiddenProgrammer/CVE-2021-21315-PoC



## 修复方案

* 使用follow-redirects的beforeRedirect防止任意302跳转的情况(https://www.npmjs.com/package/follow-redirects)

